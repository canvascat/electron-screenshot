import{r as e,a as t,s as n,d as o,t as a,c as l,w as s,b as r,e as i,f as c,g as u,p as h,h as d,o as m,l as p,i as f,j as v,k as b,m as g,n as w,q as y,F as x,u as M,v as _,x as E,y as R,z as k,A as O,B as C,C as L}from"./vendor.17d9bcc3.js";let T;!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const o=new URL(e,location),a=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,l)=>{const s=new URL(e,o);if(self[t].moduleMap[s])return n(self[t].moduleMap[s]);const r=new Blob([`import * as m from '${s}';`,`${t}.moduleMap['${s}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){l(new Error(`Failed to import: ${e}`)),a(i)},onload(){n(self[t].moduleMap[s]),a(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("assets/");const I={},S=function(e,t){if(!t)return e();if(void 0===T){const e=document.createElement("link").relList;T=e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(t.map((e=>{if(e in I)return;I[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":T,t||(o.as="script",o.crossOrigin=""),o.href=e,document.head.appendChild(o),t?new Promise(((e,t)=>{o.addEventListener("load",e),o.addEventListener("error",t)})):void 0}))).then((()=>e()))},j=Object.freeze(["CREATE","MOVE","RESIZE"]),P=Object.freeze(["TEXT","RECT","ELLIPSE","LINE","ARROW","BRUSH","MOSAIC"]);Object.freeze(["RETURN","SAVE","CANCEL","CONFIRM"]);const A="#ff0000",$=2,U=new Image,D=e(!1),N=t({x:{min:0,max:0},y:{min:0,max:0}}),B=t({x:-999,y:-999,h:0,w:0}),V=e(null),z=e(null),F=n([]),H=e(null);function W(e=F){if(0===e.length)return void(H.value=null);null!=H.value||(H.value={x:{min:0,max:0},y:{min:0,max:0}});const t=e.reduce(((e,{path:t})=>(t&&e.push(...t),e)),[]),[n,o]=t.reduce(((e,[t,n])=>(e[0].push(t),e[1].push(n),e)),[[],[]]);H.value.x.min=Math.min(...n),H.value.x.max=Math.max(...n),H.value.y.min=Math.min(...o),H.value.y.max=Math.max(...o)}const q=e(null),X=[{icon:"A",label:"添加文字(TODO)",id:"TEXT",cursor:"text"},{icon:"⬜",label:"矩形工具",id:"RECT",attr:t({color:A,width:$})},{icon:"⚪",label:"椭圆工具",id:"ELLIPSE",attr:t({color:A,width:$})},{icon:"╱",label:"直线工具",id:"LINE",attr:t({color:A,width:$})},{icon:"↗",label:"箭头工具",id:"ARROW",attr:t({color:A,width:$})},{icon:"🖊",label:"笔刷工具",id:"BRUSH",attr:t({color:A,width:$})},{icon:"🐴",label:"马赛克工具",id:"MOSAIC"}],Z=Math.PI/6;function G(e,t=10){const{width:n,height:o}=e.canvas,[a,l]=[Math.ceil(n/t),Math.ceil(o/t)],s=e.getImageData(0,0,n,o).data,r=new Uint8ClampedArray(a*l*4);for(let i=0;i<a*l;i++){const e=Math.floor(i/a),l=i-e*a;let[c,u,h,d]=[0,0,0,0];for(let a=e*t;a<Math.min((e+1)*t,o);a++){const e=a*n;for(let o=l*t;o<Math.min((l+1)*t,n);o++){const t=4*(e+o);c+=s[t],u+=s[t+1],h+=s[t+2],d++}}[r[4*i],r[4*i+1],r[4*i+2],r[4*i+3]]=[c/d,u/d,h/d,255]}return r}function Y(e,t,n=10,o=30,a){const{height:l,width:s}=e.canvas,r=((e,t,n,o)=>n.reduce(((n,[a,l])=>{const[s,r]=[Math.max(0,a-o),Math.min(a+o,e)],[i,c]=[Math.max(0,l-o),Math.min(l+o,t)];for(let t=i;t<c;t++)for(let i=s;i<r;i++)(i-a)**2+(t-l)**2<o**2&&(n[t*e+i]=!0);return n}),Array(e*t).fill(!1)))(s,l,t,o/2),[i,c]=[Math.ceil(s/n),Math.ceil(l/n)],u=e.getImageData(0,0,s,l).data,h=new Uint8ClampedArray(s*l*4);null!=a||(a=G(e,n));for(let d=0;d<c;d++){const[e,t]=[d*n,Math.min((d+1)*n,l)];for(let o=0;o<i;o++){const[l,c]=[o*n,Math.min((o+1)*n,s)],m=4*(d*i+o),[p,f,v,b]=[a[m],a[m+1],a[m+2],255];for(let n=e;n<t;n++)for(let e=l;e<c;e++){const t=n*s+e,o=4*t;r[t]?(h[o]=p,h[o+1]=f,h[o+2]=v,h[o+3]=b):(h[o]=u[o],h[o+1]=u[o+1],h[o+2]=u[o+2],h[o+3]=u[o+3])}}}e.putImageData(new ImageData(h,s,l),0,0)}const J=e=>new Promise(((t,n)=>e.toBlob((e=>e?t(e):n(new Error("Failed to convert file"))))));function K(e,t,n,o,a){const l=document.createElement("canvas");Object.assign(l,{height:a,width:o});return l.getContext("2d").drawImage(e,t,n,o,a,0,0,o,a),l}function Q(e,t=z.value.getContext("2d"),n=U){t.clearRect(0,0,N.x.max,N.y.max),t.drawImage(n,0,0),e.forEach((e=>{var n;const{width:o=$,color:a=A}=null!=(n=e.attr)?n:{};switch(e.id){case"LINE":{const[n,l]=e.path;!function(e,t,n,o,a){e.lineWidth=o,e.strokeStyle=a,e.lineCap="round",e.beginPath(),e.moveTo(...t),e.lineTo(...n),e.stroke()}(t,n,l,o,a);break}case"RECT":{const[n,l]=e.path;!function(e,t,n,o,a){const[[l,s],[r,i]]=[t,n],c=[t,[l,i],n,[r,s]];e.beginPath(),e.moveTo(...t),c.slice(1).forEach((t=>e.lineTo(...t))),e.closePath(),e.lineWidth=o,e.strokeStyle=a,e.stroke()}(t,n,l,o,a);break}case"ARROW":{const[n,l]=e.path;!function(e,t,n,o,a){const[l,s]=t,[r,i]=n,c=Math.atan((s-i)/(l-r)),u=Math.abs((r-l)/(Math.cos(c)*Math.cos(Z))),h=Math.min(u,6+2*o),d=r<l?-1:1,[m,p]=[r-Math.cos(c-Z)*h*d,i-Math.sin(c-Z)*h*d],[f,v]=[r-Math.cos(c+Z)*h*d,i-Math.sin(c+Z)*h*d],[b,g]=[(f-m)/3,(v-p)/3],[w,y]=[m+b,p+g],[x,M]=[f-b,v-g],_=[[l,s],[w,y],[m,p],[r,i],[f,v],[x,M]];e.beginPath(),e.moveTo(l,s),_.slice(1).forEach((t=>e.lineTo(...t))),e.closePath(),e.fillStyle=a,e.fill()}(t,n,l,o,a);break}case"ELLIPSE":{const[n,l]=e.path;!function(e,t,n,o,a){const[[l,s],[r,i]]=[t,n],[c,u]=[l-r,s-i].map((e=>Math.abs(e/2))),[h,d]=[(l+r)/2,(s+i)/2],m=Math.max(c,u),[p,f]=[c/m,u/m];e.save(),e.scale(p,f),e.beginPath(),e.arc(h/p,d/f,m,0,2*Math.PI),e.closePath(),e.restore(),e.lineWidth=o,e.strokeStyle=a,e.stroke()}(t,n,l,o,a);break}case"BRUSH":!function(e,t,n,o){if(t.length<2)return;e.lineWidth=n,e.strokeStyle=o,e.lineCap="round",e.beginPath();let a=t[0];e.moveTo(...a);for(let l=1;l<t.length-1;l++){const[[n,o],[s,r]]=t.slice(l,l+2),[i,c]=[n+(s-n)/2,o+(r-o)/2];e.quadraticCurveTo(n,o,i,c),a=[i,c]}e.lineTo(...t.slice(-1)[0]),e.stroke(),e.closePath()}(t,e.path,o,a);break;case"MOSAIC":Y(t,e.path,10,30,q.value)}}))}function ee(e){let t=!1;return function(...n){t||(t=!0,window.requestAnimationFrame((()=>{e.apply(this,n),t=!1})))}}async function te(e,t=document.title){var n,o;if(!("Notification"in window))throw new Error("This browser does not support notification");if("granted"===Notification.permission)return e.icon||(e.icon=null!=(o=null==(n=document.querySelector("link[rel*=icon]"))?void 0:n.getAttribute("href"))?o:void 0),new Notification(t,e);if("denied"===Notification.permission)throw new Error("notification permission denied");return await Notification.requestPermission(),await te(e,t)}const ne=()=>navigator.mediaDevices.getDisplayMedia().then((e=>new Promise(((t,n)=>{const o=document.createElement("video");o.setAttribute("autoplay","true"),((e=0)=>new Promise((t=>setTimeout(t,e))))(1e3).then(n),o.onplay=()=>t(o),o.srcObject=e})))).then((e=>{var t;const{videoHeight:n,videoWidth:o}=e,a=document.createElement("canvas");Object.assign(a,{height:n,width:o}),null==(t=a.getContext("2d"))||t.drawImage(e,0,0);return e.srcObject.getTracks().forEach((e=>e.stop())),e.srcObject=null,J(a)})),oe=10,ae=10,[le,se]=[120,88],[re,ie]=[le/4,se/4];var ce=o({props:{mousePoint:{type:Object,required:!0},canvas:{type:Object,required:!0}},setup(t){const{mousePoint:n,canvas:o}=a(t),r=e(null),i=l((()=>{const e={};if(n.value){const[t,o]=n.value,[a,l]=[oe+120,ae+120],s=t+a>N.x.max?t-a:t+oe,r=o+l>N.y.max?o-l:o+ae;e.left=`${s}px`,e.top=`${r}px`}return e}));return s(n,ee((e=>{if(!e||!o.value||!r.value)return;const[t,n]=e,a=r.value.getContext("2d");a.clearRect(0,0,le,se),a.drawImage(o.value,t-re/2,n-ie/2,re,ie,0,0,le,se)}))),document.body.style,{canvasRef:r,DW:le,DH:se,style:i}}});const ue=u("data-v-515d9b03");h("data-v-515d9b03");const he={class:"capture-info__view"},de=i("svg",{viewBox:"0 0 120 88",xmlns:"http://www.w3.org/2000/svg",fill:"none"},[i("path",{d:"M 0 1 H 119 V87 H1 V1",stroke:"red","stroke-width":"2"}),i("path",{d:"M 0 44 H 119",stroke:"red","stroke-width":"2"}),i("path",{d:"M 60 0 V 88",stroke:"red","stroke-width":"2"})],-1),me={class:"capture-info__p"};d();const pe=ue(((e,t)=>(m(),r("div",{class:"capture-info__wrap",style:e.style},[i("div",he,[i("canvas",{ref:"canvasRef",width:e.DW,height:e.DH},null,8,["width","height"]),de]),i("div",me,[c(e.$slots,"default")])],4))));ce.render=pe,ce.__scopeId="data-v-515d9b03";const fe=(e,t=100,n=100)=>[e,Math.round(t*n/((e=(2-(t/=100))*n)<1?e:200-e)||0),Math.round(e/2)];function ve(e,t=100,n=100,o){const[a,l,s]=function(e,t,n){return we(e,t,n).map((e=>Math.min(Math.round(e),255).toString(16).padStart(2,"0")))}(e,t,n);return`#${a}${l}${s}${o?Math.round(255*o/100).toString(16).padStart(2,"0"):""}`}const be=function(e,t){var n;"string"==typeof(n=e)&&-1!==n.indexOf(".")&&1===parseFloat(n)&&(e="100%");const o=(e=>"string"==typeof e&&-1!==e.indexOf("%"))(e);return e=Math.min(t,Math.max(0,parseFloat(e+""))),o&&(e=parseInt(e*t+"",10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)};function ge(e,t,n){e=be(e,255),t=be(t,255),n=be(n,255);const o=Math.max(e,t,n),a=Math.min(e,t,n);let l=0;const s=o,r=o-a,i=0===o?0:r/o;if(o===a)l=0;else{switch(o){case e:l=(t-n)/r+(t<n?6:0);break;case t:l=(n-e)/r+2;break;case n:l=(e-t)/r+4}l/=6}return[360*l,100*i,100*s]}function we(e,t,n){e=6*be(e,360),t=be(t,100),n=be(n,100);const o=Math.floor(e),a=e-o,l=n*(1-t),s=n*(1-a*t),r=n*(1-(1-a)*t),i=o%6,c=[n,s,l,l,r,n][i],u=[r,n,n,s,l,l][i],h=[l,l,r,n,n,s][i];return[Math.round(255*c),Math.round(255*u),Math.round(255*h)]}class ye{constructor(e){this.hue=0,this.saturation=100,this.value=100,this.alpha=100,this.enableAlpha=!1,this.format="hex",this.color="",!p.isEmpty(e)&&Object.assign(this,e),this.update()}toRgb(){return we(this.hue,this.saturation,this.value)}fromString(e){if(!e)return void this.update({hue:0,saturation:100,value:100});const t=(e,t,n)=>this.update({hue:Math.max(0,Math.min(360,e)),saturation:Math.max(0,Math.min(100,t)),value:Math.max(0,Math.min(100,n))});if(-1!==e.indexOf("hsl")){const n=e.replace(/hsla|hsl|\(|\)/gm,"").split(/\s|,/g).filter((e=>""!==e)).map(((e,t)=>t>2?parseFloat(e):parseInt(e,10)));if(4===n.length?this.alpha=Math.floor(100*parseFloat(""+n[3])):3===n.length&&(this.alpha=100),n.length>=3){const{h:e,s:o,v:a}=function(e,t,n){n/=100;let o=t/=100;const a=Math.max(n,.01);return t*=(n*=2)<=1?n:2-n,o*=a<=1?a:2-a,{h:e,s:100*(0===n?2*o/(a+o):2*t/(n+t)),v:(n+t)/2*100}}(n[0],n[1],n[2]);t(e,o,a)}}else if(-1!==e.indexOf("hsv")){const n=e.replace(/hsva|hsv|\(|\)/gm,"").split(/\s|,/g).filter((e=>""!==e)).map(((e,t)=>t>2?parseFloat(e):parseInt(e,10)));4===n.length?this.alpha=Math.floor(100*parseFloat(""+n[3])):3===n.length&&(this.alpha=100),n.length>=3&&t(n[0],n[1],n[2])}else if(-1!==e.indexOf("rgb")){const n=e.replace(/rgba|rgb|\(|\)/gm,"").split(/\s|,/g).filter((e=>""!==e)).map(((e,t)=>t>2?parseFloat(e):parseInt(e,10)));4===n.length?this.alpha=Math.floor(100*parseFloat(n[3].toString())):3===n.length&&(this.alpha=100),n.length>=3&&t(...ge(n[0],n[1],n[2]))}else if(-1!==e.indexOf("#")){const n=e.replace("#","").trim();if(!/^[0-9a-fA-F]*$/.test(n))return;const o=n.length;if(![3,4,6,8].includes(o))return;const a=e=>1===e.length?e+e:e,l=e=>parseInt(a(e),16),s=3===o||4===o?1:2,[r,i,c,u]=p.range(o/s).map((e=>l(n.substr(e*s,s))));this.alpha=Math.floor(null!=u?u:100),t(...ge(r,i,c))}}compare(e){return Math.abs(e.hue-this.hue)<2&&Math.abs(e.saturation-this.saturation)<1&&Math.abs(e.value-this.value)<1&&Math.abs(e.alpha-this.alpha)<1}update(e){e&&Object.assign(this,e);const{hue:t,saturation:n,value:o,alpha:a,format:l}=this;if(this.enableAlpha)switch(l){case"hsl":{const e=fe(t,n,o);this.color=`hsla(${t}, ${Math.round(e[1])}%, ${Math.round(e[2])}%, ${a/100})`;break}case"hsv":this.color=`hsva(${t}, ${Math.round(n)}%, ${Math.round(o)}%, ${a/100})`;break;default:{const[e,l,s]=we(t,n,o);this.color=`rgba(${e}, ${l}, ${s}, ${a/100})`}}else switch(l){case"hsl":{const e=fe(t,n,o);this.color=`hsl(${t}, ${Math.round(e[1])}%, ${Math.round(e[2])}%)`;break}case"hsv":this.color=`hsv(${t}, ${Math.round(n)}%, ${Math.round(o)}%)`;break;case"rgb":{const[e,a,l]=we(t,n,o);this.color=`rgb(${e}, ${a}, ${l})`;break}default:this.color="#"+((e,t,n)=>[e,t,n].map((e=>e.toString(16).padStart(2,"0"))))(...we(t,n,o)).join("")}return this.color}}const xe=function(e){for(const t of e){const e=t.target.__resizeListeners__||[];e.length&&e.forEach((e=>{e()}))}},Me=function(e,t){e&&(e.__resizeListeners__||(e.__resizeListeners__=[],e.__ro__=new f(xe),e.__ro__.observe(e)),e.__resizeListeners__.push(t))},_e=function(e,t){e&&e.__resizeListeners__&&(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),e.__resizeListeners__.length||e.__ro__.disconnect())};function Ee(e,t,n,o){e&&t&&n&&e.addEventListener(t,n,null!=o&&o)}function Re(e,t,n,o){if(e&&t&&n)return e.removeEventListener(t,n,null!=o&&o)}let ke=null;function Oe(e=document.getElementsByTagName("head")[0]){const t=document.createElement("style");return t.media="screen",e.appendChild(t),t}function Ce(e,t,n=function(){return null!=ke?ke:ke=Oe()}()){n&&t&&n.sheet.insertRule(e+"{"+t+"}",0)}const Le=(e,t=new Image)=>new Promise(((n,o)=>{t.onload=()=>n(t),t.onerror=e=>o(e),t.src=e})),Te=(e=new Image)=>((e="image/png")=>new Promise(((t,n)=>{const o=document.createElement("input");Object.assign(o,{accept:e,type:"file"}),o.onchange=()=>{var e;const a=null==(e=o.files)?void 0:e[0];(null==a?void 0:a.type.startsWith("image/"))?t(a):n()},o.click()})))().then((t=>Le(URL.createObjectURL(t),e))),Ie=new Map;let Se=null;function je(e,t){return function(n,o){const a=t.instance.popperRef,l=n.target,s=o.target,r=!t||!t.instance,i=!l||!s,c=e.contains(l)||e.contains(s),u=e===l,h=a&&(a.contains(l)||a.contains(s));r||i||c||u||h||t.value()}}function Pe(e,t){var n;return{documentHandler:je(e,t),bindingFn:t.value,type:null!=(n=t.arg)?n:"up"}}Ee(document,"mousedown",(e=>{Se=e;for(const{documentHandler:t,type:n}of Ie.values())"down"===n&&t(e,Se)})),Ee(document,"mouseup",(e=>{for(const{documentHandler:t,type:n}of Ie.values())"down"!==n&&t(e,Se);Se=null}));const Ae={beforeMount(e,t){Ie.set(e,Pe(e,t))},updated(e,t){Ie.set(e,Pe(e,t))},unmounted(e){Ie.delete(e)}};let $e=!1;function Ue(e,t){const n="function"==typeof t?{all:t}:t,o=ee((function(e){var t,o;null==(o=null!=(t=n.drag)?t:n.all)||o(e)})),a=function(e){var t,l;Re(document,"mousemove",o),Re(document,"mouseup",a),document.onselectstart=null,document.ondragstart=null,$e=!1,null==(l=null!=(t=n.end)?t:n.all)||l(e)};Ee(e,"mousedown",(function(e){var t,l;$e||(document.onselectstart=()=>!1,document.ondragstart=()=>!1,Ee(document,"mousemove",o),Ee(document,"mouseup",a),$e=!0,null==(l=null!=(t=n.start)?t:n.all)||l(e))}))}var De=o({name:"ColorPick",props:{modelValue:String,reference:{type:Object,required:!0},visibility:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(n,{emit:o}){const{reference:r,visibility:i}=a(n),c=e(null),u=e(null),h=e(null),d=e(""),m=e(0);let p=null;const f=t(new ye({color:n.modelValue||"#ff0000"})),g=l((()=>"hsl("+f.hue+", 100%, 50%)"));function w(e){const t=u.value;if(!t)return;const n=t.getBoundingClientRect(),[o,a]=[n.left+n.width/2,n.top+n.height/2],[l,s]=[e.x-o,e.y-a];m.value=Math.floor(180*Math.atan(s/l)/Math.PI),l<0&&(m.value+=180),m.value<0&&(m.value+=360),f.update({hue:m.value})}function y(e){const t=h.value;if(!t)return;const n=t.getBoundingClientRect(),o=Math.min(Math.max(0,e.clientY-n.top),n.height),a=Math.min(Math.max(0,e.clientX-n.left),n.width),{width:l,height:s}=n;f.update({saturation:a/l*100,value:100-o/s*100})}function x(){const{saturation:e,value:t}=f,n=h.value;if(!n)return;const{clientWidth:o,clientHeight:a}=n,[l,s]=[e*o/100,(100-t)*a/100],[r,i]=[l-o/2,s-a/2];d.value=`translateX(${r}px) translateY(${i}px)`}function M(){i.value&&(p=b(r.value,c.value,{placement:"bottom-start",modifiers:[{name:"offset",options:{offset:[0,4]}}]}),p.update())}return s((()=>n.modelValue),(e=>{e&&f.fromString(e)})),s((()=>f.color),(e=>{o("update:modelValue",e)})),s([()=>f.value,()=>f.saturation],(()=>{x()})),s((()=>f.hue),(()=>{m.value=f.hue})),s(i,M),v((()=>{Ue(u.value,w),Ue(h.value,y),x(),M()})),{popperRef:c,hueRef:u,svRef:h,hue:m,background:g,svTransform:d,color:f}}});const Ne={ref:"popperRef",class:"color-picker flex-conter"},Be={ref:"hueRef",class:"hue-bar"},Ve={class:"color-svpanel__wrap flex-conter"},ze=i("div",{class:"color-svpanel__white"},null,-1),Fe=i("div",{class:"color-svpanel__black"},null,-1);De.render=function(e,t){return m(),r("div",Ne,[i("div",Be,null,512),i("div",Ve,[i("div",{ref:"svRef",class:"color-svpanel flex-conter",style:{backgroundColor:e.background}},[ze,Fe,i("div",{class:"sv__cursor",style:{transform:e.svTransform}},null,4)],4)]),i("div",{class:"hue__cursor",style:{transform:`translateX(81px) rotate(${e.hue}deg)`}},null,4)],512)};const He=["#000000",...p.range(18).map((e=>ve(20*e))),"#ffffff"],We=[2,4,6];var qe=o({name:"StyleBox",directives:{ClickOutside:Ae},components:{ColorPick:De},props:{reference:{type:Object,required:!0},visibility:{type:Boolean,default:!0},color:{type:String},width:{type:Number}},emits:["update:color","update:width"],setup(t,{emit:n}){const{visibility:o,reference:r}=a(t),i=e(null),c=l({get:()=>t.color,set:e=>n("update:color",e)}),u=e(!1);let h=null;function d(){o.value&&(h=b(r.value,i.value,{placement:"bottom-start",modifiers:[{name:"offset",options:{offset:[0,4]}}]}),h.update())}function m(e=!u.value){u.value=e}const f=p.debounce(m,100);return s(o,d),v((()=>{d()})),g((()=>{null==h||h.destroy()})),{COLORS:He,WIDTHS:We,colorPickVisibility:u,popperRef:i,refColor:c,togglePicker:m,hide:function(){f(!1)}}}});const Xe={ref:"popperRef",class:"style-box"},Ze={key:1,class:"color-box"};qe.render=function(e,t){const n=w("color-pick"),o=y("click-outside");return m(),r("div",Xe,[e.width?(m(!0),r(x,{key:0},M(e.WIDTHS,(t=>(m(),r("button",{key:t,class:["width__button",t===e.width&&"active"],style:`--size-width-height: ${t}px;`,onClick:n=>e.$emit("update:width",t)},null,14,["onClick"])))),128)):_("",!0),e.color?(m(),r("div",Ze,[i("button",{class:"select-color",style:{backgroundColor:e.color},title:e.color,onClick:t[1]||(t[1]=t=>e.togglePicker())},null,12,["title"]),(m(!0),r(x,null,M(e.COLORS,(t=>(m(),r("button",{key:t,title:t,class:"color__button",style:{backgroundColor:t},"data-color":t,onClick:n=>e.$emit("update:color",t)},null,12,["title","data-color","onClick"])))),128)),e.colorPickVisibility?E((m(),r(n,{key:0,modelValue:e.refColor,"onUpdate:modelValue":t[2]||(t[2]=t=>e.refColor=t),reference:e.popperRef},null,8,["modelValue","reference"])),[[o,e.hide]]):_("",!0)])):_("",!0)],512)};const Ge=0,Ye=6,Je=[{icon:"↩",label:"撤销",id:"RETURN"},{icon:"⚡",label:"更换底图(使用本地文件)",id:"USE_UPLOAD_FILE"},{icon:"✂",label:"更换底图(使用屏幕快照)",id:"USE_SCREEN_CAPTURE"},{icon:"⬇",label:"保存(下载图片)",id:"SAVE"},{icon:"❌",label:"取消",id:"CANCEL"},{icon:"✔",label:"确定(复制到剪切板)",id:"CONFIRM"}];var Ke=o({name:"ToolBox",components:{StyleBox:qe},emits:["dispatch"],setup(n,o){const a=e(null),s=t({w:0,h:0}),r=l((()=>{const e={};if(D.value&&"CREATE"!==V.value){const{x:t,y:n,w:o,h:a}=B,l=n+a+Ye+s.h+Ye>N.y.max?Math.max(n-s.h-Ye,N.y.min):n+a+Ye,r=Math.max(t+o-s.w-Ge,N.x.min+Ge);e.left=`${r}px`,e.top=`${l}px`}else e.visibility="hidden";return e})),i=l((()=>X.find((({id:e})=>e===V.value)))),c=l((()=>{var e;return null==(e=i.value)?void 0:e.attr})),u=ee((function(){const{width:e,height:t}=a.value.getBoundingClientRect();Object.assign(s,{w:e,h:t})}));return v((()=>{Me(a.value,u)})),g((()=>{_e(a.value,u)})),{TOOL_ACTIONS:X,OPT_ACTIONS:Je,style:r,action:V,styleBoxVisibility:c,currentTool:i,handleExecCmd:function e(t){switch(t){case"SAVE":{const{x:e,y:t,w:n,h:o}=B;!function(e,t,n,o,a){const l=K(e,t,n,o,a),s=l.toDataURL("image/png");J(l).then(console.log);const r=document.createElement("a");r.download=`导出图片${Date.now()}.png`,r.href=s,r.click()}(z.value,e,t,n,o);break}case"CONFIRM":{const{x:e,y:t,w:o,h:a}=B;(n=K(z.value,e,t,o,a),navigator.permissions.query({name:"clipboard-write"}).then((async({state:e})=>{if("granted"!==e)throw new Error("clipboard-permissoin not granted");return J(n).then((e=>{const{type:t}=e;return navigator.clipboard.write([new ClipboardItem({[t]:e})])}))}))).then((()=>{te({body:"图片已复制"},"提示")}),(e=>{var t;te({body:null!=(t=null==e?void 0:e.message)?t:"图片复制失败"},"提示")}));break}case"RETURN":if(0===F.length)break;F.pop(),Q(F),W();break;case"CANCEL":F.length=1,e("RETURN"),Object.assign(B,{x:-999,y:-999,h:0,w:0});break;case"USE_UPLOAD_FILE":{const e=U.src;Te(U).then((()=>{F.length=0,Q(F),URL.revokeObjectURL(e)}));break}case"USE_SCREEN_CAPTURE":{const e=U.src;((e=new Image)=>ne().then((t=>Le(URL.createObjectURL(t),e))))(U).then((()=>{F.length=0,Q(F),URL.revokeObjectURL(e)}));break}default:return void console.log("TODO EXEC CMD => ",t)}var n;o.emit("dispatch",t)},handleUpdateTool:function(e){V.value=V.value===e?null:e},toolBoxRef:a}}});const Qe=i("div",{class:"tool-divider"},null,-1);Ke.render=function(e,t){var n;const o=w("StyleBox");return m(),r(x,null,[i("div",{ref:"toolBoxRef",class:"tool-box",style:e.style},[(m(!0),r(x,null,M(e.TOOL_ACTIONS,(t=>(m(),r("button",{key:t.id,class:["tool-item",e.action===t.id&&"active"],title:t.label,onClick:n=>e.handleUpdateTool(t.id)},R(t.icon),11,["title","onClick"])))),128)),Qe,(m(!0),r(x,null,M(e.OPT_ACTIONS,(t=>(m(),r("button",{key:t.id,class:"tool-item",title:t.label,onClick:n=>e.handleExecCmd(t.id)},R(t.icon),9,["title","onClick"])))),128))],4),(null==(n=e.currentTool)?void 0:n.attr)?(m(),r(o,{key:0,color:e.currentTool.attr.color,"onUpdate:color":t[1]||(t[1]=t=>e.currentTool.attr.color=t),width:e.currentTool.attr.width,"onUpdate:width":t[2]||(t[2]=t=>e.currentTool.attr.width=t),reference:e.toolBoxRef},null,8,["color","width","reference"])):_("",!0)],64)};const et=[{position:["top"],cursor:"ns-resize"},{position:["bottom"],cursor:"ns-resize"},{position:["left"],cursor:"ew-resize"},{position:["right"],cursor:"ew-resize"},{position:["top","left"],cursor:"nwse-resize"},{position:["bottom","right"],cursor:"nwse-resize"},{position:["top","right"],cursor:"nesw-resize"},{position:["bottom","left"],cursor:"nesw-resize"}];var tt=o({name:"App",components:{InfoBox:ce,ToolBox:Ke},setup(){const t=e(null);let n=null;const o=e(null),a=e("0, 0, 0");let r=p.cloneDeep(B),i=[],c=null;const u=l((()=>V.value&&["CREATE","RESIZE"].includes(V.value))),h=l((()=>{const{x:e,y:t,h:n,w:o}=B,[a,l,s,r]=[e,t,n,o].map((e=>`${e}px`)),i={left:a,top:l,height:s,width:r,cursor:""};return V.value||(i.cursor="move"),i})),d=l((()=>{var e;return null==(e=z.value)?void 0:e.getContext("2d")}));s(o,ee((e=>{if(!d.value||!e)return;const{data:t}=d.value.getImageData(e[0],e[1],1,1);a.value=t.slice(0,3).join(", ")})));const m=ee((async function(){const{clientHeight:e,clientWidth:t}=document.body;N.x.max=t,N.y.max=e,await k(),Q(F,d.value,U)}));function f(e){if(0!==e.button)return x();D.value=!0;const{x:t,y:n}=e;Object.assign(B,{x:t,y:n}),V.value="CREATE",Ce("*","cursor: crosshair !important;",c=Oe()),w(e)}const b=ee((function(e){var t,a,l,s,c,u,h,m;if(!n||!V.value)return;const[f,v]=n;let b=Math.min(Math.max(e.x,N.x.min),N.x.max),g=Math.min(Math.max(e.y,N.y.min),N.y.max);const[w,y]=[b-f,g-v];o.value=[b,g];const[x]=F.slice(-1);if(j.includes(V.value))switch(V.value){case"CREATE":const[e,n]=[Math.min(f,b),Math.min(v,g)],[o,d]=[Math.abs(w),Math.abs(y)],[p,x]=[Math.min(o,N.x.max-e),Math.min(d,N.y.max-n)];Object.assign(B,{x:e,y:n,w:p,h:x});break;case"MOVE":{const{x:e,y:n}=r,{h:o,w:i}=B,c=H.value;B.x=Math.min(Math.max(e+w,N.x.min,(null!=(t=null==c?void 0:c.x.max)?t:-1/0)-i),N.x.max-i,null!=(a=null==c?void 0:c.x.min)?a:1/0),B.y=Math.min(Math.max(n+y,N.y.min,(null!=(l=null==c?void 0:c.y.max)?l:-1/0)-o),N.y.max-o,null!=(s=null==c?void 0:c.y.min)?s:1/0);break}case"RESIZE":{const{h:e,y:t,w:n,x:o}=r,a=H.value;i.includes("top")?(g=Math.min(g,null!=(c=null==a?void 0:a.y.min)?c:1/0),B.y=Math.min(g,t+e),B.h=Math.abs(t-g+e)):i.includes("bottom")&&(g=Math.max(g,null!=(u=null==a?void 0:a.y.max)?u:-1/0),B.y=Math.min(g,t),B.h=Math.abs(g-t)),i.includes("left")?(b=Math.min(b,null!=(h=null==a?void 0:a.x.min)?h:1/0),B.x=Math.min(b,o+n),B.w=Math.abs(o-b+n)):i.includes("right")&&(b=Math.max(b,null!=(m=null==a?void 0:a.x.max)?m:-1/0),B.x=Math.min(b,o),B.w=Math.abs(b-o));break}}else if(P.includes(V.value)){if((null==x?void 0:x.id)!==V.value)return;const e=function([e,t]){const{x:n,y:o,w:a,h:l}=B;return[Math.max(Math.min(e,n+a),n),Math.max(Math.min(t,o+l),o)]}([b,g]),[t]=x.path.slice(-1);if(p.isEqual(e,t))return;switch(V.value){case"LINE":case"RECT":case"ARROW":case"ELLIPSE":x.path[1]=e;break;case"BRUSH":case"MOSAIC":x.path.push(e);break;default:return}Q(F,d.value,U)}}));function w(e){r=p.cloneDeep(B),e.stopImmediatePropagation();const{x:t,y:a}=e;n=[t,a],o.value=[t,a],document.addEventListener("mousemove",b),document.addEventListener("mouseup",y),document.onselectstart=()=>!1}function y(){var e;n=null,document.onselectstart=null,null==(e=null==c?void 0:c.parentNode)||e.removeChild(c),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",y),"MOSAIC"===V.value&&(q.value=null),j.includes(V.value)&&(V.value=null);const[t]=F.slice(-1);t&&t.path&&t.path.length<=1&&F.pop(),W()}function x(){D.value=!1,function(e,t,n){const o=function(a){n&&n.call(this,a),Re(e,t,o)};Ee(e,t,o)}(t.value,"mousedown",f)}return v((()=>{Me(document.body,m),x()})),g((()=>{_e(document.body,m)})),{onMousedownCaptureLayer:function(e){var t,n;if(V.value){if(P.includes(V.value)){const o={id:V.value,path:[[e.x,e.y]]},a=null==(n=V.value,t=X.find((e=>e.id===n)))?void 0:t.attr;a&&Object.assign(o,{attr:p.cloneDeep(a)}),F.push(o),"MOSAIC"===V.value&&(q.value=G(d.value,10)),w(e)}}else!function(e){V.value||(V.value="MOVE",Ce("*","cursor: move !important;",c=Oe()),w(e))}(e)},startResize:function(e,{position:t,cursor:n}){V.value="RESIZE",i=t,Ce("*",`cursor: ${n} !important;`,c=Oe()),w(e)},handleToolCmd:function(e){switch(e){case"CANCEL":x()}},captureLayerStyle:h,mousePoint:o,RESIZE_POINTS:et,RGB:a,captureLayer:B,infoBoxVisible:u,bound:N,canvasRef:z,wrapRef:t}}});const nt={ref:"wrapRef",class:"wrapper"};tt.render=function(e,t){const n=w("info-box"),o=w("tool-box");return m(),r(x,null,[i("div",nt,[i("canvas",{ref:"canvasRef",width:e.bound.x.max,height:e.bound.y.max},null,8,["width","height"]),i("div",{class:"capture-layer",style:e.captureLayerStyle,onMousedown:t[1]||(t[1]=O(((...t)=>e.onMousedownCaptureLayer&&e.onMousedownCaptureLayer(...t)),["left"]))},[(m(!0),r(x,null,M(e.RESIZE_POINTS,(t=>(m(),r("button",{key:t.position.join(),style:t.position.reduce(((e,t)=>Object.assign(e,{[t]:"-3px"})),{cursor:t.cursor}),class:"resize-point",onMousedown:O((n=>e.startResize(n,t)),["left","prevent"])},null,44,["onMousedown"])))),128))],36),e.infoBoxVisible?(m(),r(n,{key:0,"mouse-point":e.mousePoint,canvas:e.canvasRef},{default:C((()=>[i("p",null,R(e.captureLayer.w)+" x "+R(e.captureLayer.h),1),i("p",null,"RGB("+R(e.RGB)+")",1)])),_:1},8,["mouse-point","canvas"])):_("",!0)],512),i(o,{onDispatch:e.handleToolCmd},null,8,["onDispatch"])],64)};{null!=window._hmt||(window._hmt=[]);const e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?4e02e53abd8605530e0c10481dabdca0";const t=document.querySelector("script");t.parentNode.insertBefore(e,t)}Promise.all(p.range(0,8).map((e=>function(e){switch(e){case"./assets/0.jpg":return S((()=>__import__("./0.0f566388.js")),void 0);case"./assets/1.jpg":return S((()=>__import__("./1.9a9df9d9.js")),void 0);case"./assets/2.jpg":return S((()=>__import__("./2.3820c810.js")),void 0);case"./assets/3.jpg":return S((()=>__import__("./3.6adf29f6.js")),void 0);case"./assets/4.jpg":return S((()=>__import__("./4.5e23b482.js")),void 0);case"./assets/5.jpg":return S((()=>__import__("./5.7e2f0bda.js")),void 0);case"./assets/6.jpg":return S((()=>__import__("./6.20f56a99.js")),void 0);case"./assets/7.jpg":return S((()=>__import__("./7.28cf4bbf.js")),void 0);default:return Promise.reject(new Error("Unknown variable dynamic import: "+e))}}(`./assets/${e}.jpg`).then((e=>e.default))))).then((e=>fetch(e[p.random(e.length)-1]))).then((e=>e.blob())).then((e=>Le(URL.createObjectURL(e),U))).then((()=>L(tt).mount("#app")));
